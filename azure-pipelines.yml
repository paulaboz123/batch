trigger:
  branches:
    include:
      - main

pool:
  vmImage: ubuntu-latest

variables:
  LOCATION: 'westeurope'

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.10'
      addToPath: true

  - script: |
      python -m pip install --upgrade pip
      pip install -r requirements-dev.txt
    displayName: Install dependencies

  # This expects Workload Identity Federation / Managed Identity auth so DefaultAzureCredential works.
  # Provide env vars in a Variable Group (recommended):
  # SUBSCRIPTION_ID, RESOURCE_GROUP, WORKSPACE_NAME, ENDPOINT_NAME,
  # COMPUTE_DE/EN/PL, MODEL_NAME_DE/EN/PL,
  # plus Azure identity vars (AZURE_TENANT_ID, AZURE_CLIENT_ID, etc.) depending on your setup.

  - script: |
      python scripts/create_or_update.py
    displayName: Create/Update batch endpoint and deployments
    env:
      SUBSCRIPTION_ID: $(SUBSCRIPTION_ID)
      RESOURCE_GROUP: $(RESOURCE_GROUP)
      WORKSPACE_NAME: $(WORKSPACE_NAME)
      ENDPOINT_NAME: $(ENDPOINT_NAME)
      LOCATION: $(LOCATION)

      COMPUTE_DE: $(COMPUTE_DE)
      COMPUTE_EN: $(COMPUTE_EN)
      COMPUTE_PL: $(COMPUTE_PL)

      MODEL_NAME_DE: $(MODEL_NAME_DE)
      MODEL_NAME_EN: $(MODEL_NAME_EN)
      MODEL_NAME_PL: $(MODEL_NAME_PL)
